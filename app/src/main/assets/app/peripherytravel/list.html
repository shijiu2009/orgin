<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta id="viewport"
		  content="target-densitydpi=320, user-scalable=yes,width=320, minimum-scale=1, initial-scale=1,maximum-scale=1, user-scalable=no"
		  name="viewport">
	<title>线路列表</title>
	<link rel="shortcut icon" href="../favicon.ico">
	<link rel="stylesheet" href="../css/app/jquery.mobile-1.4.2.css">
	<link rel="stylesheet" href="../css/app/layout.css">
	<link href="../css/app/scrollbar.css" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="../css/font-awesome.min.css">
	<script src="../js/jquery.min.js"></script>
	<script src="../js/jquery.mobile-1.4.2.min.js"></script>
	<script src="../js/iscroll.js" type="text/javascript"></script>
	<script src="../js/ucapp.js" type="text/javascript"></script>
	<style type="text/css">
		.fade.in {
			min-width: 100% !important;
			max-width: 100% !important;
			top: 1.86rem !important;
			right: 0px !important;
			left: 0px !important;
			position: fixed;
		}
	</style>
</head>

<body>
<div data-role="page" id="scenic">
	<div data-role="header" data-position="fixed" class="normal_head"> <a data-role="button"
																		  onclick="javascript:ucapp.goToBack();" data-rel="back" data-transition="slide"
																		  class="ui-btn-left nav_back"> <img src="../images/app/nav_back.png"> </a>
		<a href="../search/index.html" data-transition="slide" data-ajax="false" class="search8"><img
				src="../images/app/search.png"><span id="tittop">搜<span
				class="distination"></span>景点/酒店/线路/特产/攻略</span></a>
		<div id="grid" class="ui-grid-b c_tad">

			<div class="ui-block-a"><a href="#dfs124" data-rel="popup" data-transition="fade"
									   class="ui-bar ui-bar-a">
				<div class="d3"  id="ttv"  onclick="cls(1)" id="ttv">智能排序<i class="fa fa-caret-down"></i></div>
			</a>
				<div data-role="popup" id="dfs124" class="ui-content filter">
					<ul data-role="listview" data-icon="false" id="" class="filter_list">
						<li>
							<a href="javascript:paisort(0);">
								<h2>智能排序</h2>
							</a>
						</li>
						<li>
							<a href="javascript:paisort(2);">
								<h2>最新发布</h2>
							</a>
						</li>
						<li>
							<a href="javascript:paisort(1);">
								<h2>价格最低</h2>
							</a>
						</li>
						<li><a href="javascript:paisort(3);">
							<h2>价格最高</h2>
						</a>
						</li>
						<li><a href="javascript:paisort(4);">
							<h2>距离最近</h2>
						</a>
						</li>
					</ul>

				</div>
			</div>
			<div class="ui-block-b">
				<a href="#dfs125" data-rel="popup" data-transition="fade" class="ui-bar ui-bar-a">
					<div class="d3"  onclick="cls(2)">时长<i class="fa fa-caret-down"></i></div>
				</a>
				<div data-role="popup" id="dfs125" class="ui-content filter">
					<ul data-role="listview" data-icon="false" id="" class="filter_list">

						<li>
							<div class="wa">
								<div id="gridlevel" class="ui-grid-c sle_tad">
									<div class="ui-block-a"><a href="#" id="vv0" onclick="sellvel(0)"
															   data-ajax="false" class="first">
										<div class="d4">不限</div>
									</a></div>
									<div class="ui-block-b"><a href="#" id="vv1" onclick="sellvel(1)"
															   data-ajax="false">
										<div class="d4">一日游</div>
									</a></div>
									<div class="ui-block-c"><a href="#" id="vv2" onclick="sellvel(2)"
															   data-ajax="false">
										<div class="d4">两日游</div>
									</a></div>
									<div class="ui-block-d"><a href="#" id="vv3" onclick="sellvel(3)"
															   data-ajax="false">
										<div class="d4">三日游</div>
									</a></div>
									<div class="ui-block-d"><a href="#" id="vv4" onclick="sellvel(4)"
															   data-ajax="false">
										<div class="d4">三日游以上</div>
									</a></div>
								</div>
							</div>
						</li>
						<!--<li>
          <div class="wa"><h2>赠送项目</h2><select name="slider-flip-m" id="slider-flip-m" data-role="slider" data-mini="true" class="xz">
        <option value="off">No</option>
        <option value="on" selected>Yes</option>
    </select></div>
        </li>-->
						<!-- <li>
                            <div class="wa" style="background-color:#f6f6f6; padding:0px;">
                                <a href="#" onclick="chongzhi()" class="cz">重置</a>
                                <a href="#" onclick="closesaoxuan()" class="qd">确定</a>
                            </div>
                        </li> -->
					</ul>

				</div>
			</div>

			<div class="ui-block-c"><a href="#dfs123" data-rel="popup" data-transition="fade"
									   class="ui-bar ui-bar-a">
				<div class="d3" onclick="cls(0)">主题<i class="fa fa-caret-down"></i></div>
			</a>
				<div data-role="popup" id="dfs123" class="ui-content filter">
					<ul data-role="listview" data-icon="false" id="" class="filter_list">
						<li>
							<div class="wa">
								<div id="gridthe" class="ui-grid-c sle_tad">
									<div class="ui-block-a"><a href="#" id="nn0" onclick="selthe(0)"
															   data-ajax="false" class="first">
										<div class="d4">不限</div>
									</a></div>
								</div>
							</div>
						</li>
					</ul>
					<!-- <ul data-role="listview" data-icon="false" id="" class="filter_list">
                    <li class="all">
                        <a href="#">
                            <h2>好玩<span class="distination"></span></h2>
                        </a>
                    </li>
                </ul>
                <ul data-role="listview" data-icon="false" id="" class="filter_citylist">
                    <li>
                        <a href="../attractions/list.html" data-ajax="false">
                            <h2>热门景点</h2>
                            <div class="num" id="attr">0</div>
                        </a>
                    </li>
                    <li>
                        <a href="../peripherytravel/list.html" data-ajax="false">
                            <h2>精品线路</h2>
                            <div class="num" id="per">0</div>
                        </a>
                    </li>
                    <li>
                        <a href="../hotel/list.html??hotelOrHome=1" data-ajax="false">
                            <h2>酒店住宿</h2>
                            <div class="num" id="hotel">0</div>
                        </a>
                    </li>
                    <li>
                        <a href="../hotel/list.html?hotelOrHome=2" data-ajax="false">
                            <h2>特色民宿</h2>
                            <div class="num" id="minsu">0</div>
                        </a>
                    </li>
                    <li><a href="../article/xiuxianlist.html" data-ajax="false">
                            <h2>休闲娱乐</h2>
                            <div class="num" id="xxyl">0</div>
                        </a>
                    </li>
                    <li><a href="../interaction/list.html" data-ajax="false">
                            <h2>游记攻略</h2>
                            <div class="num" id="inter">0</div>
                        </a>
                    </li>

                </ul>
                <ul data-role="listview" data-icon="false" id="" class="filter_list">
                    <li class="all">
                        <a href="#">
                            <h2>好吃<span class="distination"></span></h2>
                        </a>
                    </li>
                </ul>
                <ul data-role="listview" data-icon="false" id="" class="filter_citylist">
                    <li>
                        <a href="../product/list.html?byname=lycp" data-ajax="false">
                            <h2>旅游产品</h2>
                            <div class="num" id="lycp">0</div>
                        </a>
                    </li>
                    <li>
                        <a href="../product/list.html?byname=dbtc" data-ajax="false">
                            <h2>地标特产</h2>
                            <div class="num" id="dbtc">0</div>
                        </a>
                    </li>
                    <li>
                        <a href="../product/list.html?byname=tsms" data-ajax="false">
                            <h2>特色美食</h2>
                            <div class="num" id="tsms">0</div>
                        </a>
                    </li> -->
					<!-- <li><a href="../product/list.html?byname=lysx" data-ajax="false"><h2>旅游手信</h2><div class="num" id="lysx">0</div></a>
    </li>
    <li><a href="../wonderful/featurelist.html" data-ajax="false"><h2>特色餐馆</h2><div class="num" id="tscg">0</div></a>
    </li> -->

					<!-- </ul> -->

				</div>
			</div>
		</div>
	</div>
	<div class="ui-panel-wrapper">
		<div data-role="content">

			<div id="wrapper" style="" class="index_list2">
				<div id="scroller">
					<div id="pullDown">
						<!-- 			<span class="pullDownIcon"></span><span class="pullDownLabel">下拉刷新...</span> -->
					</div>

					<ul data-role="listview" data-icon="false" id="thelist">

					</ul>

					<div id="pullUp">
						<!-- 			<span class="pullUpIcon"></span><span class="pullUpLabel">上拉加载更多...</span> -->
					</div>

				</div>
			</div>
		</div>
	</div>

</div>
<script type="text/javascript">
		var currage = 1;
		var totalPage = 1;
		var orderBy = 0;
		var grade = null; //行程天数
		var thhemid = null;//主题id
		var title;
		$(function () {

			var Request = new Object();
			Request = getRequest();
			title = Request["title"];

			reload();
		});

		function reload() {
			$("#thelist").empty();
			statistics();
			getdate();
		}

		function getdate() {
			ucapp.post(getWebRoot() + "app/peripherytravel/getdate.do", { "title": title, "page": currage, "days": grade, "orderBy": orderBy, "themeId": thhemid }, function (data) {
				if (data.rows) {
					totalPage = data.pages;
					$(data.rows).each(function (i, o) {
						var obj = o;
						var dd = ''
						if (obj.todayPrice == null || obj.todayPrice == '') {
							dd = '<div class="price"><span>免费</span></div>'
						} else {
							dd = '<div class="price"><span><em>￥</em>' + obj.todayPrice + '</span>起</div>';
						}
						var div = '<li><a href="detail.html?id=' + obj.id + '" data-transition="fade" data-ajax="false">' +
							'<img src="' + getImageUrl() + obj.thumbPath + '" class="t_img"><h2>' + obj.title + '</h2>' +
							'<p ></p>' +
							'<div class="text_2"><h3>满意度' + obj.haoping + '%</h3><h4>' + obj.numcomment + '点评</h4></div>' + dd +
							'</a></li>';
						$("#thelist").append(div);
					});
				}
			});
		}
		function sellvel(les) {
			currage = 1;
			if (les == 0) {
				grade = null;
			} else {
				grade = les;
			}
			$("#gridlevel a").attr("class", "");
			$("#vv" + les).attr("class", "first");
			$("#gridlevel").trigger("create");
			$("#dfs125").popup("close");
			$("#thelist").html("");
			getdate()
		}

		function selthe(theid) {
			currage = 1;
			thhemid = theid;
			if (theid == 0) {
				thhemid = null;
			}
			$("#gridthe a").attr("class", "");
			$("#nn" + theid).attr("class", "first");
			$("#gridthe").trigger("create");
			$("#dfs123").popup("close");
			$("#thelist").html("");
			getdate();
		}

		function statistics() {
			ucapp.post(getWebRoot() + "app/peripherytravel/statistics.do", {}, function (data) {
				if (data.themelist) {
					for (var j = 0; j < data.themelist.length; j++) {
						var cc = "";
						if (j % 4 == 0) {
							cc = 'ui-block-b';
						} else if (j % 4 == 1) {
							cc = 'ui-block-c';
						} else if (j % 4 == 2) {
							cc = 'ui-block-d';
						} else if (j % 4 == 3) {
							cc = 'ui-block-a';
						}
						var di = '<div class="' + cc + '"><a href="#" id="nn' + data.themelist[j].id + '" onclick="selthe(' + data.themelist[j].id + ')" data-ajax="false"><div class="d4">' + data.themelist[j].name + '</div></a></div>';
						$("#gridthe").append(di);
					}
					$("#gridthe").trigger("create");
				}

				if (data.xxyl) {
					$("#xxyl").html(data.xxyl);
				}
				if (data.tscg) {
					$("#tscg").html(data.tscg);
				}
				if (data.lycp) {
					$("#lycp").html(data.lycp);
				}
				if (data.dbtc) {
					$("#dbtc").html(data.dbtc);
				}
				if (data.lysx) {
					$("#lysx").html(data.lysx);
				}
				if (data.tsms) {
					$("#tsms").html(data.tsms);
				}
				if (data.attr) {
					$("#attr").html(data.attr);
				}
				if (data.per) {
					$("#per").html(data.per);
				}
				if (data.hotel) {
					$("#hotel").html(data.hotel.length);
				}
				if (data.minsu) {
					$("#minsu").html(data.minsu.length);
				}
				if (data.inter) {
					$("#inter").html(data.inter);
				}
			});
		}

		function closesaoxuan() {
			$("#dfs125").popup("close");
			$("#thelist").empty();
			currage = 1;
			getdate();
		}

		function chongzhi() {
			$("#nn0").click();
			$("#vv0").click();
		}
		function paisort(so) {
			orderBy = so;
			$("#thelist").empty();
			if (so == 0) {
				$("#ttv").html("智能排序");
			} else if (so == 2) {
				$("#ttv").html("最新发布");
			} else if (so == 1) {
				$("#ttv").html("价格最低");
			} else if (so == 3) {
				$("#ttv").html("价格最高");
			} else if (so == 4) {
				$("#ttv").html("距离最近");
			}
			currage = 1;
			$("#dfs124").popup("close");
			getdate();
		}
		function cls(ty) {
			if (ty == 0) {
				$("#dfs123").popup("close");
			} else if (ty == 1) {
				$("#dfs124").popup("close");
			} else if (ty == 2) {
				$("#dfs125").popup("close");
			}

		}


		var myScroll,
			pullDownEl, pullDownOffset,
			pullUpEl, pullUpOffset,
			generatedCount = 0;

		/**
		* 下拉刷新 （自定义实现此方法）
		* myScroll.refresh();		// 数据加载完成后，调用界面更新方法
		*/
		function pullDownAction() {
			setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
				var el, li, i;
				/* 	el = document.getElementById('thelist'); */

				/* for (i=0; i<3; i++) {
					li = document.createElement('li');
					li.innerText = 'Generated row ' + (++generatedCount);
					el.insertBefore(li, el.childNodes[0]);
					
				} */
				//     currage= 1;
				// 	$("#thelist").empty();         
				// 	getdate();
				myScroll.refresh();		//数据加载完成后，调用界面更新方法   Remember to refresh when contents are loaded (ie: on ajax completion)
			}, 1000);	// <-- Simulate network congestion, remove setTimeout from production!
		}

		/**
		* 滚动翻页 （自定义实现此方法）
		* myScroll.refresh();		// 数据加载完成后，调用界面更新方法
		*/
		function pullUpAction() {
			setTimeout(function () {	// <-- Simulate network congestion, remove setTimeout from production!
				/* var el, li, i;
				el = document.getElementById('thelist');
			
				for (i=0; i<3; i++) {
					li = document.createElement('li');
					li.innerText = 'Generated row ' + (++generatedCount);
					el.appendChild(li, el.childNodes[0]);
				} */
				if (currage < totalPage) {
					currage++;
					// 		 $("#thelist").empty();          
					getdate();
				}
				myScroll.refresh();		// 数据加载完成后，调用界面更新方法 Remember to refresh when contents are loaded (ie: on ajax completion)

			}, 1000);	// <-- Simulate network congestion, remove setTimeout from production!
		}

		/**
		* 初始化iScroll控件
		*/
		function loaded() {
			pullDownEl = document.getElementById('pullDown');
			pullDownOffset = pullDownEl.offsetHeight;
			pullUpEl = document.getElementById('pullUp');
			pullUpOffset = pullUpEl.offsetHeight;

			myScroll = new iScroll('wrapper', {
				scrollbarClass: 'myScrollbar', /* 重要样式 */
				useTransition: false, /* 此属性不知用意，本人从true改为false */
				topOffset: pullDownOffset,
				onRefresh: function () {
					// 		if (pullDownEl.className.match('loading')) {
					// 			pullDownEl.className = '';
					// 			pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
					// 		} else 
					if (pullUpEl.className.match('loading')) {
						pullUpEl.className = '';
						if (currage == totalPage) {
							pullUpEl.querySelector('.pullUpLabel').innerHTML = '已到底部';
						} else {
							pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
						}
					}
				},
				onScrollMove: function () {
					// 		if (this.y > 5 && !pullDownEl.className.match('flip')) {
					// 			pullDownEl.className = 'flip';
					// 			pullDownEl.querySelector('.pullDownLabel').innerHTML = '松手开始更新...';
					// 			this.minScrollY = 0;
					// 		} else if (this.y < 5 && pullDownEl.className.match('flip')) {
					// 			pullDownEl.className = '';
					// 			pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
					// 			this.minScrollY = -pullDownOffset;
					// 		} else 
					if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
						pullUpEl.className = 'flip';
						pullUpEl.querySelector('.pullUpLabel').innerHTML = '松手开始更新...';
						this.maxScrollY = this.maxScrollY;
					} else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
						pullUpEl.className = '';
						pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
						this.maxScrollY = pullUpOffset;
					}
				},
				onScrollEnd: function () {
					// 		if (pullDownEl.className.match('flip')) {
					// 			pullDownEl.className = 'loading';
					// 			pullDownEl.querySelector('.pullDownLabel').innerHTML = '加载中...';				
					// 			pullDownAction();	// Execute custom function (ajax call?)
					// 		} else 
					if (pullUpEl.className.match('flip')) {
						pullUpEl.className = 'loading';
						pullUpEl.querySelector('.pullUpLabel').innerHTML = '加载中...';
						pullUpAction();	// Execute custom function (ajax call?)
					}
				}
			});

			setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
		}

		//初始化绑定iScroll控件 
		document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
		document.addEventListener('DOMContentLoaded', loaded, false); 
	</script>
</body>

</html>