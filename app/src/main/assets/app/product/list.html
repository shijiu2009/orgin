<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta id="viewport"
		content="target-densitydpi=320, user-scalable=yes,width=320, minimum-scale=1, initial-scale=1,maximum-scale=1, user-scalable=no"
		name="viewport">
	<title>产品列表</title>
	<link rel="shortcut icon" href="../favicon.ico">
	<link rel="stylesheet" href="../css/app/jquery.mobile-1.4.2.css">
	<link rel="stylesheet" href="../css/app/layout.css?d=3">
	<link href="../css/app/scrollbar.css" rel="stylesheet" type="text/css">
	<script src="../js/jquery.min.js"></script>
	<script src="../js/jquery.mobile-1.4.2.min.js"></script>
	<script src="../js/ucapp.js"></script>
	<style type="text/css">
		.fade.in {
			min-width: 100% !important;
			max-width: 100% !important;
			top: 1.86rem !important;
			right: 0px !important;
			left: 0px !important;
			position: fixed;
		}
	</style>
</head>

<body>
	<div data-role="page" id="scenic">
		<div data-role="header" data-position="fixed" class="normal_head"> <a data-role="button"
				onclick="ucapp.goToBack()" data-rel="back" data-transition="slide" class="ui-btn-left nav_back"> <img
					src="../images/app/nav_back.png"> </a>
			<a href="../search/index.html" data-transition="slide" data-ajax="false" class="search8"><img
					src="../images/app/search.png">搜<span class="distination"></span>景点/酒店/线路/特产/攻略</a>
			<h1 style="display:none;"></h1>
			<div id="grid" class="ui-grid-b c_tad">

				<div class="ui-block-a"><a href="javascript:sortPop()" data-rel="popup" data-transition="fade"
						class="ui-bar ui-bar-a">
						<div class="d3" id="ttv">智能排序<i class="fa fa-caret-down"></i></div>
					</a>
					<div data-role="popup" id="dfs124" class="ui-content filter">
						<ul data-role="listview" data-icon="false" id="" class="filter_list">
							<li>
								<a href="javascript:paisort(0);">
									<h2>智能排序</h2>
								</a>
							</li>
							<li>
								<a href="javascript:paisort(2);">
									<h2>最新发布</h2>
								</a>
							</li>
							<li>
								<a href="javascript:paisort(1);">
									<h2>价格最低</h2>
								</a>
							</li>
							<li><a href="javascript:paisort(3);">
									<h2>价格最高</h2>
								</a>
							</li>
							<li><a href="javascript:paisort(4);">
									<h2>距离最近</h2>
								</a>
							</li>
						</ul>

					</div>
				</div>
				<div class="ui-block-b">
					<a href="javascript:pricePop()" data-rel="popup" data-transition="fade" class="ui-bar ui-bar-a">
						<div class="d3">级别<i class="fa fa-caret-down"></i></div>
					</a>
					<div data-role="popup" id="dfs125" class="ui-content filter">
						<ul data-role="listview" data-icon="false" id="" class="filter_list">

							<li>
								<div class="wa">
									<div id="gridlevel" class="ui-grid-c sle_tad">
										<div class="ui-block-a"><a href="#" id="vv0" onclick="sellvel(0)"
												data-ajax="false" class="first">
												<div class="d4">不限</div>
											</a></div>
										<!-- <div class="ui-block-b"><a href="#" id="vv5" onclick="sellvel(5)" data-ajax="false"><div class="d4">5星</div></a></div> -->
										<!-- <div class="ui-block-c"><a href="#" id="vv4" onclick="sellvel(4)"
												data-ajax="false">
												<div class="d4">4星</div>
											</a></div>
										<div class="ui-block-d"><a href="#" id="vv3" onclick="sellvel(3)"
												data-ajax="false">
												<div class="d4">3星</div>
											</a></div> -->
									</div>
								</div>
							</li>
							<!--<li>
              <div class="wa"><h2>赠送项目</h2><select name="slider-flip-m" id="slider-flip-m" data-role="slider" data-mini="true" class="xz">
            <option value="off">No</option>
            <option value="on" selected>Yes</option>
        </select></div>
            </li>-->
							<!-- <li>
								<div class="wa" style="background-color:#f6f6f6; padding:0px;">
									<a href="#" onclick="chongzhi()" class="cz">重置</a>
									<a href="#" onclick="closesaoxuan()" class="qd">确定</a>
								</div>
							</li> -->
						</ul>

					</div>
				</div>

				<div class="ui-block-c"><a href="javascript:areaPop()" data-rel="popup" data-transition="fade"
						class="ui-bar ui-bar-a">
						<div class="d3">分类<i class="fa fa-caret-down"></i></div>
					</a>
					<div data-role="popup" id="dfs123" class="ui-content filter">
						<ul data-role="listview" data-icon="false" id="" class="filter_list">
							<li>
								<a href="../product/list.html?byname=lycp" data-ajax="false"><h2>旅游产品</h2><div class="num" id="lycp">0</div></a>
							  </li>
							  <li>
								<a href="../product/list.html?byname=dbtc" data-ajax="false"><h2>地标特产</h2><div class="num" id="dbtc">0</div></a>
							  </li>
							  <li>
								<a href="../product/list.html?byname=tsms" data-ajax="false"><h2>特色美食</h2><div class="num" id="tsms">0</div></a>
							  </li>
						</ul>
						<!-- <ul data-role="listview" data-icon="false" id="" class="filter_list">
						<li class="all">
							<a href="#">
								<h2>好玩<span class="distination"></span></h2>
							</a>
						</li>
					</ul>
					<ul data-role="listview" data-icon="false" id="" class="filter_citylist">
						<li>
							<a href="../attractions/list.html" data-ajax="false">
								<h2>热门景点</h2>
								<div class="num" id="attr">0</div>
							</a>
						</li>
						<li>
							<a href="../peripherytravel/list.html" data-ajax="false">
								<h2>精品线路</h2>
								<div class="num" id="per">0</div>
							</a>
						</li>
						<li>
							<a href="../hotel/list.html??hotelOrHome=1" data-ajax="false">
								<h2>酒店住宿</h2>
								<div class="num" id="hotel">0</div>
							</a>
						</li>
						<li>
							<a href="../hotel/list.html?hotelOrHome=2" data-ajax="false">
								<h2>特色民宿</h2>
								<div class="num" id="minsu">0</div>
							</a>
						</li>
						<li><a href="../article/xiuxianlist.html" data-ajax="false">
								<h2>休闲娱乐</h2>
								<div class="num" id="xxyl">0</div>
							</a>
						</li>
						<li><a href="../interaction/list.html" data-ajax="false">
								<h2>游记攻略</h2>
								<div class="num" id="inter">0</div>
							</a>
						</li>

					</ul>
					<ul data-role="listview" data-icon="false" id="" class="filter_list">
						<li class="all">
							<a href="#">
								<h2>好吃<span class="distination"></span></h2>
							</a>
						</li>
					</ul>
					<ul data-role="listview" data-icon="false" id="" class="filter_citylist">
						<li>
							<a href="../product/list.html?byname=lycp" data-ajax="false">
								<h2>旅游产品</h2>
								<div class="num" id="lycp">0</div>
							</a>
						</li>
						<li>
							<a href="../product/list.html?byname=dbtc" data-ajax="false">
								<h2>地标特产</h2>
								<div class="num" id="dbtc">0</div>
							</a>
						</li>
						<li>
							<a href="../product/list.html?byname=tsms" data-ajax="false">
								<h2>特色美食</h2>
								<div class="num" id="tsms">0</div>
							</a>
						</li> -->
						<!-- <li><a href="../product/list.html?byname=lysx" data-ajax="false"><h2>旅游手信</h2><div class="num" id="lysx">0</div></a>
		</li>
		<li><a href="../wonderful/featurelist.html" data-ajax="false"><h2>特色餐馆</h2><div class="num" id="tscg">0</div></a>
		</li> -->

						<!-- </ul> -->

					</div>
				</div>
			</div>
		</div>
		<div class="ui-panel-wrapper">
			<div data-role="content">

				<div id="wrapper" class="index_list2">
					<div id="scroller">

						<ul data-role="listview" data-icon="false" id="thelist">


						</ul>


					</div>
				</div>
			</div>
		</div>

	</div>
	<script type="text/javascript">
		var currage = 0;
		var totalPage = 1;
		var byname = '';
		var isLoad = false;
		//监听滚动
		$(document).on("pageinit", "#scenic", function () {
			$(document).on("scrollstop", function () {
				if ($(document).scrollTop() >= $(document).height() - $(window).height() - 85) {
					if (currage < totalPage) {
						getdate();
					}
				}
			});
		});

		$(function () {
			var theRequest = getRequest();
			if (theRequest['byname'] != null) {
				byname = theRequest['byname'];
			}
			getdate();
			statistics();
		});

		function getdate() {
			if (!isLoad) {
				isLoad = true;
				currage++;
				var myObj = {
					"page": currage, "orderBy": orderBy,
					"bname": byname, "classId": classid
				};
				ucapp.post(getWebRoot() + "app/product/getdate.do", myObj, function (data) {

					if (data.rows) {
						totalPage = data.pages;
						var ptype = '';
						for (var i = 0; i < data.rows.length; i++) {
							var obj = data.rows[i];
							var dd = "";
							obj.icon = getImageUrl() + obj.icon;
							var todayPrice = obj.todayPrice;
							if (todayPrice != 0) {
								dd = '<div class="price"><span><em>￥</em>' + obj.todayPrice + '</span>起</div>';
								ptype = '<div class="p1">地方特产</div>';
							} else {
								ptype = '<div class="p2">美食推荐</div>';
							}
							var div = '<li><a href="detail.html?id=' + obj.id + '" data-transition="fade" data-ajax="false">' + ptype +
								'<img src="' + getFullImageUrl(obj.titleImg) + '" class="t_img"><h2>' + obj.name + '</h2>' +
								'<p"></p>' +
								'<div class="text_2"><h3>满意度' + obj.haoping + '%</h3><h4>' + obj.numcomment + '点评</h4></div>' + dd +
								'</a></li>';
							$("#thelist").append(div);
						}
					}
					currage = data.currPage;
					totalPage = data.maxPage;
					isLoad = false;
				});
			}
		}
		var grade = null;
		function sellvel(les) {
			currage = 0;
			if (les == 0) {
				grade = null;
			} else {
				grade = les;
			}
			$("#gridlevel a").attr("class", "");
			$("#vv" + les).attr("class", "first");
			$("#gridlevel").trigger("create");
		}

		function selthe(theid) {
			currage = 0;
			classid = theid;
			if (theid == 0) {
				classid = null;
			}
			$("#gridthe a").attr("class", "");
			$("#nn" + theid).attr("class", "first");
			$("#gridthe").trigger("create");

		}
		var classid = null;

		function statistics() {
			ucapp.post(getWebRoot() + "app/product/statistics.do", { "byname": byname }, function (data) {

				if (data.liclass) {
					for (var j = 0; j < data.liclass.length; j++) {
						var cc = "";
						if (j % 4 == 0) {
							cc = 'ui-block-b';
						} else if (j % 4 == 1) {
							cc = 'ui-block-c';
						} else if (j % 4 == 2) {
							cc = 'ui-block-d';
						} else if (j % 4 == 3) {
							cc = 'ui-block-a';
						}
						var di = '<div class="' + cc + '"><a href="#" id="nn' + data.liclass[j].id + '" onclick="selthe(' + data.liclass[j].id + ')" data-ajax="false"><div class="d4">' + data.liclass[j].name + '</div></a></div>';
						$("#gridthe").append(di);
					}
					$("#gridthe").trigger("create");
				}
				if (data.namecc != null && data.namecc != '') {
					$("#namecc").html(data.namecc);
				} else {
					$("#namecc").html('旅游产品');
				}
				if (data.xxyl) {
					$("#xxyl").html(data.xxyl);
				}
				if (data.tscg) {
					$("#tscg").html(data.tscg);
				}
				if (data.lycp) {
					$("#lycp").html(data.lycp);
				}
				if (data.dbtc) {
					$("#dbtc").html(data.dbtc);
				}
				if (data.lysx) {
					$("#lysx").html(data.lysx);
				}
				if (data.tsms) {
					$("#tsms").html(data.tsms);
				}
				if (data.attr) {
					$("#attr").html(data.attr);
				}
				if (data.per) {
					$("#per").html(data.per);
				}
				if (data.hotel) {
					$("#hotel").html(data.hotel.length);
				}
				if (data.minsu) {
					$("#minsu").html(data.minsu.length);
				}
				if (data.inter) {
					$("#inter").html(data.inter);
				}
			});
		}

		function closesaoxuan() {
			$("#dfs125").popup("close");
			$("#thelist").html("");
			currage = 0;
			getdate();
		}

		function chongzhi() {
			$("#nn0").click();
			$("#vv0").click();
		}
		var orderBy = 0;
		function paisort(so) {
			orderBy = so;
			$("#thelist").html("");
			currage = 0;
			$("#dfs124").popup("close");
			if (so == 0) {
				$("#ttv").html("智能排序");
			} else if (so == 2) {
				$("#ttv").html("最新发布");
			} else if (so == 1) {
				$("#ttv").html("价格最低");
			} else if (so == 3) {
				$("#ttv").html("价格最高");
			}
			getdate();
		}
		var areaint = 0;
		var priceint = 0;
		var sortint = 0;

		function areaPop() {

			if (sortint == 1) {
				sortint = 0;
				closePop('#dfs124');
				setTimeout(function () {
					openAreaPop();
				}, 100);
				return;
			}
			if (priceint == 1) {
				priceint = 0;
				closePop('#dfs125');
				setTimeout(function () {
					openAreaPop();
				}, 100);
				return;
			}
			openAreaPop();
		};
		function openAreaPop() {
			if (areaint == 0) {
				areaint = 1;
				openPop('#dfs123');
			} else if (areaint == 1) {
				areaint = 0;
				closePop('#dfs123');
			}
		}
		function pricePop() {
			if (sortint == 1) {
				sortint = 0;
				closePop('#dfs124');
				setTimeout(function () {
					openPricePop();
				}, 100);
				return;
			}
			if (areaint == 1) {
				areaint = 0;
				closePop('#dfs123');
				setTimeout(function () {
					openPricePop();
				}, 100);
				return;
			}
			openPricePop();

		};
		function openPricePop() {
			if (priceint == 0) {
				priceint = 1;
				openPop('#dfs125');
			} else if (priceint == 1) {
				priceint = 0;
				closePop('#dfs125');
			}
		}
		function sortPop() {
			if (areaint == 1) {
				areaint = 0;
				closePop('#dfs123');
				setTimeout(function () {
					openSortPop();
				}, 100);
				return;
			}
			if (priceint == 1) {
				priceint = 0;
				closePop('#dfs125');
				setTimeout(function () {
					openSortPop();
				}, 100);
				return;
			}
			openSortPop();

		};
		function openSortPop() {
			if (sortint == 0) {
				sortint = 1;
				openPop('#dfs124');
			} else if (sortint == 1) {
				sortint = 0;
				closePop('#dfs124');
			}

		};
		function closePop(id) {
			//alert('closePop:'+id);
			$(id).popup("close");
		};
		function openPop(id) {
			//alert('openPop:'+id);
			$(id).popup();
			$(id).popup('open');
			$('' + id + '-popup').addClass('fade in');
			$('' + id + '-popup').css('top', '0px');
		}
	</script>
</body>

</html>